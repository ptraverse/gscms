extends layout

block content
	body(ng-app='aqpApp')
		.container			
			.jumbotron				
				p
					input.input-lg.full-width(type="text" id="sheetUrl" placeholder="Enter Publicly Shared Google Sheet URL")
					br
					br
					input.input-lg.full-width(type="text" id="queryString" placeholder="Enter Query String")
					br
					br
					input.input-lg.full-width(type="textarea" id="graphScriptUrl" placeholder="Enter Raw Gist URL to Custom Javascript")
				p
					a.btn.btn-lg.btn-success(href='#', role='button', id="getSome") Get Some
		.container.col-centered
			#chart_div.col-centered

block additional_js	
	script(type="text/javascript" charset="utf-8").
		$(document).ready( function() {
			console.log('working');

			$('#getSome').on('click', function() {
				var sheetUrl = $('#sheetUrl').attr('value');
				retrieveSheetData(sheetUrl);
			});

			var retrieveSheetData = function(sheetUrl) {
				var queryString = encodeURIComponent('SELECT *');
				var query = new google.visualization.Query(sheetUrl + queryString);
				query.send(handleSampleDataQueryResponse);
			};

			var handleSampleDataQueryResponse = function(response) {
				if (response.isError()) {
				alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
					return;
				}
				var data = response.getDataTable();
				console.log(data);

				var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
				chart.draw(data, {width: 400, height: 240});
			};

			var initDev = function() {
				//in dev mode, auto populate with test sheet
				$('#sheetUrl').attr('value', 'https://docs.google.com/spreadsheets/d/1A8mOPi0RrAiCWfyGH3MThtyo-wyrA3y8mAOS2TTw8Hc/edit?usp=sharing');

				//in dev mode use test querystring
				$('#queryString').attr('value', 'SELECT A2:A6');

				//in dev mode, auto populate with test script
				$('#graphScriptUrl').attr('value', '');
			};

			initDev();
		});
